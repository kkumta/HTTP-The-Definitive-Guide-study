# Chapter 6 : 프록시

## 6.1 웹 중개자
- 클라이언트는 프록시가 요청을 받아도 서버에 요청하는 것처럼 대한다.
- 프록시는 웹 클라이언트이면서 웹 서버이다.
- 개인 프록시 : ISP 서비스, 브라우저 확장 기능 등으로 사용. 널리 사용하는 것은 아님
- 공용 프록시 : 대부분 프록시가 해당되는 부분
- 프록시와 게이트웨이 차이
  - 명확한 차이는 없음. 프록시도 게이트웨이처럼 동작할 수 있다.(프로토콜을 변환할 수 있다.)

## 6.2 왜 프록시를 사용하는가?
- 사용 목적 : 필터링, 접근 제어(방화벽 역할), 캐싱, 콘텐츠 라우터, 트랜스코더, 익명화, 로드 밸런싱

## 6.3 프록시는 어디에 있는가?
- reverse proxy : 클라이언트가 요청할 때 요청이 프록시를 거친다. 클라이언트는 서버의 IP를 알 수 없다. 
- forward proxy : 클라이언트에서 서버로 리소스를 요청할 때, 프록시 서버를 거쳐서 요청한다. 서버에서 받는 IP가 클라이언트의 IP가 아닌 프록시의 IP이기 때문에 서버는 누구인지 알 수 없다.

## 6.5 프록시 요청의 미묘한 특징들
- 프록시 URI는 서버 URI와 다르다.
  - 예전에는 단일 서버와 클라이언트가 통신했으나, 지금은 프록시를 거쳐서 통신하는 경우이기 때문.
- 가상 호스팅 : 하나의 서버에 여러 도메인 이름을 호스팅하는 방식.
  - 프록시 요청 시 문제가 발생할 수 있다.
    - port 정보를 포함해서 특정 호스트를 지정해서 해결
    - 완전한 URI를 갖도록 함으로써 특정 호스트가 누구인지 알 수 있다.

## 6.6 메시지 추적
- 웹 요청은 서버로 향하는 도중에 여러 프록시를 지나게 된다.
  - Via 헤더 : 메시지가 지나는 중간 노드(프록시, 게이트웨이) 정보를 나열한다.
  - Via와 게이트웨이 : 프록시로 HTTP 요청을 했는데, FTP 서버를 거치고 올 수 있다.(게이트웨이를 거침), 이 때 변경된 프로토콜 정보를 나타낸다.
- TRACE 메서드
  - 프록시가 메시지 내용을 변경할 수 있는데, TRACE 헤더로 변경과 프록시를 추적할 수 있다. (디버깅에 유용함)

## 6.8 프록시 상호운용성
- HTTP를 구현해도 여러 버전에 대해 구현되었을 수도 있다.
  - OPTIONS를 통해서 지원하는 헤더와 메서드를 확인할 수 있다.

# Chapter 19 : 배포 시스템

- 세부적인 내용이고 현재 표준으로 잘 쓰이지 않기 때문에 생략.

# Chapter 20 : 리다이렉트

## 20.1 왜 리다이렉트인가?
- 웹 콘텐츠는 여러 장소에 배포된다. 실패한 경우 다른 곳을 이용할 수 있다.
  - www.google.com 으로 접속하면 한국 서버로 리다이렉트 된다.

## 20.2 리다이렉트 할 곳
- 어디로 리다이렉트할 것인가? 클라이언트 입장에서는 모두 같은 서버이다.
  - 원본 서버에서 컨텐츠를 가져올 수도 있으나 원본 서버로 왔을 경우 가까운 캐시 서버로 리다이렉트할 수 있다.
  - 이러한 리다이렉트 시 판단할 근거는 무엇인가?

## 20.3 리다이렉션 프로토콜의 개요

### http 리다이렉션
- 302 코드와 함께 리다에렉트 메시지를 받는다.
- 클라이언트는 Location에 해당되는 url로 재요청을 보낸다.
- 사용자가 2번 왕복할 필요가 있다.
- 리다이렉트된 서버에 장애가 발생할 경우, 요청을 처리할 수 없다.
- 다른 리다이렉션과 조합해서 사용한다.

### DNS 리다이렉션
- 네이버는 여러 서버가 존재할 수 있다.
  - 여러 서버들도 하나의 naver.com으로 접근이 가능하다.
  - dns는 여러 서버들 중에서 어떤 서버를 선택하여 ip를 줘야 하는가?
- 단순하게 라운드로빈 방법으로 나눌 수 있다.
- 만약 클라이언트 애플리케이션에서 dns 캐싱이 동작할 경우 부하 분산이 불가능하다. 어떻게 해결할 것인가?
  - 총량으로 보았을 때 적절히 부하가 분산된다.

### 임의 캐스트 어드레싱
- 이해가 안됨. 인터넷에 관련 자료를 찾을 수 없음.
- 서버가 어떻게 라우터에게 '광고'를 할 수 있는가?

### 아이피 맥 포워딩
- layer2에서는 mac 주소를 통해서 전달된다.
- mac 주소는 또 다른 mac 주소를 가진 장비로 전달된다. (허브 -> 스위치)
- 만약 특정 포트 번호를 특정한 mac 주소로만 보내도록 설정할 수 있다.
  - 1234포트로 오는 것은 프록시 장비 mac 주소로만 보낸다.
  - 나머지 포트로 오는 것은 기본 값으로 보낸다.
- 가까운 장비에만 한정된 기능이다. (1 hop 안에서만 가능하다.)

### 아이피 주소 포워딩
- 아이피 맥 포워딩보다 유연하다.(1 hop이 아니어도 된다.)
- 패킷이 들어오면 목적지 mac 주소가 아닌 ip 주소의 변경에 따라 라우팅된다.
- 목적지와 출발지 아이피 주소 양쪽을 번역해주는 장치를 완전 NAT
- 클라이언트의 아이피 주소로 계속 남아있다면 half NAT