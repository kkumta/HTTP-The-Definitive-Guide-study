# 16장 국제화

- 문자집합 인코딩 : 여러 언어의 문자로 텍스트를 보여주고 요청하기 위해 사용

- 언어 태그 : 사용자가 이해할 수 있는 언어만으로 콘텐츠를 서술하기 위해 사용

- 서버는 클라이언트에게 Content-Type charset 과 Content-Language 헤더를 보내서 어떤 문자집합을 사용하고 어떤 언어로 콘텐츠를 서술하는지 알려준다.

- 클라이언트는 서버에게 Accept-Charset 과 Accept-Language 헤더를 보내서 어떤 인코딩 알고리즘들과 언어들을 지원하는지 알려준다.

```
  Accept-Language: fr, en;q=0.8
  Accept-Charset: iso-8859-1, utf-8
```

## 언어 태그와 HTTP

프랑스어 문서에 어떤이는 French 라고 할 수도 있고, France, fr, Fra 등등 다양하기 때문에 표준이 필요함.

언어 태그는 위와 같은 것들을 표준화한 것.

Content-Language 헤더에 언어 태그를 포함해서 어떤 언어 사용자를 대상으로 하고 있는지 서술한다.

```
Content-Language: fr
// 여러 언어 사용자를 대상으로 하면 ,로 나열한다. ex) fr, en
```

### 서브 태그

언어 태그는 하이픈으로 분리된 하나 이상의 서브태그로 이루어져 있다.

- 첫 번째 서브태그는 주 서브태그라 불리며 이 값은 표준화되어 있다.
- 두 번째 서브태그는 선택적이고 자신만의 이름 표준을 따른다.
- 세 번째부터의 서브태그는 등록되어 있지 않다.
- 모든 태그는 대소문자 구분 안함.
- 첫 번째와 두 번째 서브태그는 표준으로서 기관에서 관리된다.

```
  sgn-US-MA

  sgn: 첫 번째 서브태그(수화)
  US: 두 번째 서브태그(미국)
  MA: 세 번째 서브태그(메사추세츠 지역 변종)
```

## 국제화된 URI

- URI 이스케이프는 예약된 문자나 지원하지 않는 글자들(스페이스 공백)과 같은 것들을 안전하게 URI에 삽입할 수 있는 방법을 제공한다.
  - % 뒤에 2자리 16진수를 붙여서 표현한다.
  - US-ASCII 코드의 범위에 있어야 한다.

<br >
<br >
<br >

# 17장 내용 협상과 트랜스코딩

- 하나의 URL이 여러 리소스에 대응해야 할때 HTTP는 클라이언트와 서버가 이러한 판단을 할 수 있게 `내용 협상(content-negotiation)` 을 지원한다.

- 서버는 특정 URL에 대해 어떤 콘텐츠가 클라이언트에게 보내주기 가장 적절한지에 대한 판단도 해야 하는데 트랜스코딩은 서버와 클라 사이의 내용 협상에 대한 응답에서 수행된다.

<br >
<br >

## 내용 협상 기법

| 기법            | 어떻게 동작하는가                                                            | 장점                                                   | 단점                                               |
| --------------- | ---------------------------------------------------------------------------- | ------------------------------------------------------ | -------------------------------------------------- |
| 클라이언트 주도 | 클라이언트가 요청을 보내면, 서버는 선택지를 보내주고, 클라이언트가 선택한다. | 서버 입장에서 구현 쉬움, 클라이언트는 최선의 선택 가능 | 대기시간 증가, 최소 두번의 요청 필요               |
| 서버 주도       | 서버가 클라이언트의 요청 헤더를 검증해서 어떤 버전을 제공할지 결정           | 클라이언트 주도 보다 빠르다.                           | 헤더에 맞는 결정이 없으면 서버는 추측을 해야 한다. |
| 투명            | 프락시가 서버를 대신해 협상                                                  | 클라이언트 주도 협상보다 빠르다                        | 정형화된 명세가 없다.                              |

<br >
<br >

## 내용 협상 헤더

| 헤더            | 설명                                                |
| --------------- | --------------------------------------------------- |
| Accept          | 서버가 어떤 미디어 타입으로 보내도 되는지 알려준다. |
| Accept-Language | 서벅 ㅏ어떤 언어로 보내도 되는지 알려준다.          |
| Accept-Charset  | 서버가 어떤 차셋으로 보내도 되는지 알려준다.        |
| Accept-Encoding | 서버가 어떤 인코딩으로 보내도 되는지 알려준다.      |

<br >
<br >

### Accept 관련 헤더들과 짝을 이루는 엔터티 헤더들

| Accept 관련 헤더들 | 엔터티 헤더      |
| ------------------ | ---------------- |
| Accept             | Content-Type     |
| Accept-Language    | Content-Language |
| Accept-Charset     | Content-Type     |
| Accept-Encoding    | Content-Encoding |

<br >
<br >

## 내용 협상 헤더의 품질값

클라이언트가 선호하는 항목들마다 선호도를 표시할 수 있다. 이를 품질값(quality value)이라 한다.

q값은 0.0부터 1.0까지의 값을 가진다.(1.0이 가장 높은 선호도)

```
Accept-Language: en;q=0.5, fr;q=0.0, nl;q=1.0, tr:q=0.0
```

<br >
<br >

## 그 외의 헤더들에 의해 결정

서버는 또한 User-Agent와 같은 클라이언트의 다른 요청 헤더들을 이용해 알맞은 요청을 만들어내려고 시도할 수 있다.

그리고 캐시에서는 Vary 헤더를 통해 서버가 내줄 응답의 최선의 버전을 결정하기 위해 어떤 요청 헤더를 참고하고 있는지 말해준다.

## 투명 협상

클라이언트 입장에서 협상하는 중개자 프락시를 둠으로써 투명한 중간 장치(주로 프락시 캐시)가 서버를 대신하여 협상을 한다.

이를 위해 Vary헤더를 통해 서버는 클라이언트의 요청중 어떤 헤더를 검사해야 하는지 프락시에게 말해준다.

<br >
<br >

## Vary 헤더

Vary 헤더는 서버가 문서를 선택하거나 커스텀 콘텐츠를 생성할 때 고려한 클라이언트 요청 헤더 모두를 나열한다.

## 트랜스코딩

서버가 클라이언트의 요구에 맞는 문서를 아예 갖고 있지 못할 때 서버의 기존 문서를 클라이언트가 사용할 수 있게 변환하는걸 `트랜스코딩` 이라 한다.

- 포맷 변환
  - 데이터를 클라이언트가 볼 수 있는 포맷으로 변환
  - 트랜스코딩은 콘텐츠 인코딩이나 전송 인코딩과는 다르다
- 정보 합성
  - 문서에서 중요 정보만 추출하는 것
  - ex) 각 절의 제목을 추출해서 개요 생성, 광고 및 로고 제거 등
- 콘텐츠 주입
  - 동적으로 페이지에 콘텐츠를 추가하는 것
  - 특정 사용자를 대상으로 하는 광고를 그때그때 삽입하는 등
